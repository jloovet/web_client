<!DOCTYPE html>
<html lang="se">

<head>
  <title>Öving 5</title>
  <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.1.0/uuidv4.min.js"></script>

  <link rel="stylesheet" type="text/css" href="App.css">
  <link rel="icon" type="image/x-icon" href="favicon.png">
  <!-- Add icon library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">
</head>


<body style="background-image: url('shopping1.jpg'); background-size: cover;">

  <div id="root"></div>

  <script type="text/babel">

    //kan ligga i en AllaSpelare.js och importeras... 
    class AllaSpelare extends React.Component {
      state = {
        spelarDB: [
          {
            id: uuidv4(),
            spelare: "Some item",
            position: "Some quantity",
            gradering: "Some sort of comment"
          },
        ]
      };

      handleChange = (id) => {
        this.setState(prevState => ({
          spelarDB: prevState.spelarDB.map(spelare => {
            if (spelare.id === id) {
              return {
                ...spelare,
              }
            }
            return spelare
          }),
        }))
      };

      delspelare = id => {
        this.setState({
          spelarDB: [
            ...this.state.spelarDB.filter(spelare => {
              return spelare.id !== id;
            })
          ]
        });
      };


      baseItemsData =
        [
        {
            id: uuidv4(),
            spelare: "six-pack of beer",
            position: "2",
            gradering: "E.g. Budweiser (max 2.8 % alc) "
          },
          {
            id: uuidv4(),
            spelare: "butter 600 g",
            position: "1",
            gradering: ""
          },
          {
            id: uuidv4(),
            spelare: "milk 1 liter",
            position: "5",
            gradering: "Should be lactose free"
          },
          {
            id: uuidv4(),
            spelare: "bread",
            position: "1",
            gradering: "Choose a brand with less suggar"
          },
          {
            id: uuidv4(),
            spelare: "Cheese",
            position: "1",
            gradering: "Cheddar or Goude"
          },
        ]

      addBaseItems = () => {
        //add all items from array
        this.setState({
          spelarDB: this.baseItemsData
          //spelarDB: [...this.state.spelarDB, this.baseItemsData]
        });
      };


      addQuote = () => {
      };


      addSpelare = (spelare, position, gradering) => {
        const newspelare = {
          id: uuidv4(),
          spelare: spelare,
          position: position,
          gradering: gradering
        };
        this.setState({
          spelarDB: [...this.state.spelarDB, newspelare]
        });
      };

      setUpdate = (updatedSpelare, id) => {
        this.setState({
          spelarDB: this.state.spelarDB.map(spelare => {
            if (spelare.id === id) {
              spelare.spelare = updatedSpelare
            }
            return spelare
          }),
        })
      }

      setUpdatePos = (updatedSpelarePos, id) => {
        this.setState({
          spelarDB: this.state.spelarDB.map(spelare => {
            if (spelare.id === id) {
              spelare.position = updatedSpelarePos
            }
            return spelare
          }),
        })
      }

      setUpdateGrad = (updatedSpelareGrad, id) => {
        this.setState({
          spelarDB: this.state.spelarDB.map(spelare => {
            if (spelare.id === id) {
              spelare.gradering = updatedSpelareGrad
            }
            return spelare
          }),
        })
      }
      render() {
        return (
          <div className="container">
            <div className="inner">
              <h1 className="sidTopp">The Professional Grocery Shopper Tool</h1>
              <div id="outer-container">
                <div id="grocery-container">
                  <SpelarTabell
                    spelarDB={this.state.spelarDB}
                    handleChangeProps={this.handleChange}
                    deleteSpelareProps={this.delspelare}
                    setUpdate={this.setUpdate}
                    setUpdatePos={this.setUpdatePos}
                    setUpdateGrad={this.setUpdateGrad}
                  />
                  <BaseItems addBaseItemsProps={this.addBaseItems} />
                  <QuoteFetcher addBaseItemsProps={this.addQuote} />

                  <br></br><br></br><br></br>
                  <NySpelare addSpelareProps={this.addSpelare} />
                </div>
                <RecipeList />
              </div>

            </div>
          </div>
        );
      }
    }

    class QuoteFetcher extends React.Component {
      state = {
        fetchedQoute: [
          {
            quote: "Ett litet steg för mig men...",
            author: "Armstrongs"
          },

        ],
      };

      //Note: limited to 500 calls / month (see https://rapidapi.com/apidojo/api/tasty/)
      //create new key before handing in ovn 6!
      options = {
        method: 'POST',
        headers: {
          'content-type': 'application/json',
          'X-RapidAPI-Key': 'a97a27dba4msh0406c51ffc2c3b6p1e955djsnfc510facd835',
          'X-RapidAPI-Host': 'quotel-quotes.p.rapidapi.com'
        },
        body: '{}'
      };

      fetchQuote = () => {
        fetch('https://quotel-quotes.p.rapidapi.com/quotes/random', options)
          .then(response => response.json())
          .then(response => console.log(response))
          .catch(err => console.error(err));
      };

      setStateFromResponse = (responseAsJSON) => {
        console.log("responseAsJSON.1 " + responseAsJSON.quote)

        for (var key in responseAsJSON.results) {
          if (responseAsJSON.results.hasOwnProperty(key)) {
            console.log(key)
            //  console.log(responseAsJSON.results[key].name)
          }
        }
      };

      render() {
        return (
          <button title="Adds a random quote to the grocery list" onClick={this.fetchQuote} className="btn-qoute"> Add a famous Qoute </button>
        )
      }
    }

    class RecipeList extends React.Component {
      state = {
        fetchedRecipeList: [
          {
            name: "Recipe Name 1",
            details: "Recipe Details 1"
          },
          {
            name: "Recipe Name 2",
            details: "Recipe Details 2"
          },
        ],
        searchKey: ""
      };

      //Note: limited to 500 calls / month (see https://rapidapi.com/apidojo/api/tasty/)
      //create new key before handing in ovn 6!
      options = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': 'a97a27dba4msh0406c51ffc2c3b6p1e955djsnfc510facd835',
          'X-RapidAPI-Host': 'tasty.p.rapidapi.com'
        }
      };

      fetchRecipeList = () => {
        fetch('https://tasty.p.rapidapi.com/recipes/list?from=0&size=20&tags=under_30_minutes&q=' + this.state.searchKey, this.options)
          .then(response => response.json())
          .then(response => this.setStateFromResponse(response))
          .catch(err => console.error(err));
      };

      setStateFromResponse = (responseAsJSON) => {
        var i = 0;
        //buid new array from result
        var newArray = []
        for (var key in responseAsJSON.results) {
          if (responseAsJSON.results.hasOwnProperty(key)) {
            console.log(key)
            console.log(responseAsJSON.results[key].name)
            let obj = {
              "name": responseAsJSON.results[key].name,
              "details": responseAsJSON.results[key].description
            }
            newArray.push(obj)
          }
        }
        //set array as state
        this.setState({
          fetchedRecipeList: newArray
          //spelarDB: [...this.state.spelarDB, this.baseItemsData]
        });
      };

      onChange = e => {
        //use name ta to update right part of state
        this.setState({
          [e.target.name]: e.target.value,
        })
      }

      render() {
        return (
          <div className="recipeList">
            <h2>Search for recepies</h2>
            <button title="Search for recepies using a search string" onClick={this.fetchRecipeList} className="btn-search"> Search  <i class="fa fa-search"></i></button>
            <input type="text"
              className="searchText"
              name="searchKey"
              onChange={this.onChange}
            />
            <ul>
              {this.state.fetchedRecipeList.map(recepi => (
                <li>{recepi.name}</li>
              ))
              }
            </ul>
          </div>
        )
      }
    }

    //kan ligga i en SpelarTabell.js och importeras... 
    class SpelarTabell extends React.Component {
      render() {
        return (
          <table>
            <caption>My Grocery shopping List:</caption>
            <tbody>
              <tr>
                <th>Name</th>
                <th>Quantity</th>
                <th>Comment</th>
              </tr>
              {this.props.spelarDB.map(spelare => (
                //SpelareITabell(spelare)  //om funk, (då man kör hoks)
                <SpelareITabell
                  key={spelare.id}
                  spelare={spelare}
                  handleChangeProps={this.props.handleChangeProps}
                  deleteSpelareProps={this.props.deleteSpelareProps}
                  setUpdate={this.props.setUpdate}
                  setUpdatePos={this.props.setUpdatePos}
                  setUpdateGrad={this.props.setUpdateGrad}
                />
              ))}
              <tr>
                <td colspan="3"> dagens citat ....</td>
              </tr>
            </tbody>
          </table>
        )
      }
    }

    //kan ligga i en SpelareITabell.js och importeras... 
    class SpelareITabell extends React.Component {

      state = {
        editing: false,
        btnText: ""

      }

      handleEditing = () => {
        if (this.state.editing) {
          this.setState({
            editing: false,
            btnText: ""
          })
        } else {
          this.setState({
            editing: true,
            btnText: "Save"
          })
        }
      }

      handleUpdatedDone = event => {
        //console.log(event.key)
        if (event.key === "Enter") {
          this.setState({ editing: false, btnText: "" })
        }
      }

      render() {
        const completedStyle = {
          fontStyle: "italic",
          color: "#595959",
          opacity: 0.4,
          textDecoration: "line-through",
        }

        //"destructure" the spelare and get variables from it
        const { position, id, spelare, gradering } = this.props.spelare


        //hantera edit-fältet
        let viewMode = {}
        let editMode = {}
        if (this.state.editing) {
          viewMode.display = "none"
        } else {
          editMode.display = "none"
        }


        return (
          <tr>
            <td className="item">
              <div style={viewMode}>
                <span style={false ? completedStyle : null}>
                  {spelare}
                </span>
              </div>
              <input
                type="text"
                style={editMode}
                className="textInput"
                value={spelare}
                onChange={e => {
                  this.props.setUpdate(e.target.value, id)
                }}
                onKeyDown={this.handleUpdatedDone}
              />
            </td>
            <td>
              <div style={viewMode}>
                <span style={false ? completedStyle : null}>
                  {position}
                </span>
              </div>

              <select style={editMode}
                className="textInput"
                value={position}
                onChange={e => {
                  this.props.setUpdatePos(e.target.value, id)
                }}>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>

            </td>
            <td>
              <div style={viewMode}>
                <span style={false ? completedStyle : null}>
                  {gradering}
                </span>
              </div>

              <input
                type="text"
                style={editMode}
                className="textInput"
                value={gradering}
                onChange={e => {
                  this.props.setUpdateGrad(e.target.value, id)
                }}
                onKeyDown={this.handleUpdatedDone}
              />

            </td>

            <td>
              <button title="Make changes to the item" style={{ fontWeight: this.state.editing ? "bold" : "normal" }} onClick={this.handleEditing}
                className="changebutton"> {this.state.btnText} <i class="fa fa-edit"></i></button>
              <button title="Delete the item" onClick={() => this.props.deleteSpelareProps(id)} className="delbutton" > <i class="fa fa-trash"></i> </button>
            </td>
          </tr>
        )
      }
    }

    class BaseItems extends React.Component {


      addAllItems = () => {
        this.props.addBaseItemsProps()
      }

      render() {
        return (
          <button title="Adds some standard groceries to the grocery list" onClick={this.addAllItems} className="btn-baseItems"> Add Base Items </button>
        )
      }
    }


    //kan ligga i en NySpelare.js och importeras... 
    class NySpelare extends React.Component {


      state = {
        spelare: "",
        position: "",
        gradering: ""
      };


      //kan hantera flera text-fält, tack tillägget name="spelare" nedan
      onChange = e => {
        this.setState({
          [e.target.name]: e.target.value,
        })
      }

      handleSubmit = e => {
        e.preventDefault()
        if (this.state.spelare.trim() == "") {
          alert("Ange spelarens namn")
          return
        }
        if (this.state.position == "" || this.state.position == "Nada") {
          alert("Ange spelarens position")
          return
        }
        this.props.addSpelareProps(this.state.spelare, this.state.position, this.state.gradering)

        //cleara state
        this.setState({
          spelare: "",
          gradering: ""
        })
      }



      render() {
        return (
          <form onSubmit={this.handleSubmit} className="form-container" >
            <fieldset>
              <legend>Add new Grocery Item:</legend>
              <input
                required title="Add Item Name here"
                placeholder="Item Name"
                type="text"
                className="form-input"
                value={this.state.spelare}
                name="spelare"
                onChange={this.onChange}
              />


              <select onChange={this.onChange} id="positioner" name="position" required title="Add number of tems here" placeholder="quantity" className="form-input">
                <option value="q">quantity</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>


              <input
                required title="Add Item Name here"
                placeholder="Comment"
                type="text"
                className="form-input"
                value={this.state.gradering}
                name="gradering"
                onChange={this.onChange}
              />



              <button title="Adds the item to the grocery list" className="btn-submit">Submit <i class="fa fa-save"></i></button>
            </fieldset>
          </form>
        )
      }
    }



    ReactDOM.render(
      <React.StrictMode>
        <AllaSpelare />
      </React.StrictMode >,
      document.getElementById("root")
    )


  </script>
</body>

</html>